<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Lua Obfuscator + Decrypt</title>
<style>
body{background:#333;color:#fff;font-family:Verdana;display:flex;justify-content:center;align-items:center;height:100vh}
.card{background:rgba(68,68,68,.6);padding:20px;border-radius:10px;width:90%;max-width:500px}
.inputBox{margin-bottom:10px;position:relative}
.inputBox input,.inputBox select{width:100%;padding:10px;background:#444;border:1px solid #666;color:#fff;border-radius:5px}
button{padding:12px;width:100%;background:#ff8f10;border:none;color:#000;font-weight:bold;border-radius:5px}
</style>
</head>
<body>

<form id="form">
<div class="card">
<h2>Lua Obfuscator</h2>

<div class="inputBox">
<select id="mode">
<option value="encrypt">Encrypt</option>
<option value="decrypt">Decrypt</option>
</select>
</div>

<div class="inputBox">
<input type="file" id="file">
</div>

<div class="inputBox">
<input type="text" id="key" placeholder="Key">
</div>

<button type="submit">PROCESS</button>
</div>
</form>

<script>
const read = new FileReader();

const xorEncrypt = (sc, key) => {
  let out = [];
  let k = 0;
  for (let i = 0; i < sc.length; i++) {
    out.push(sc.charCodeAt(i) + key.charCodeAt(k));
    k++; if (k == key.length) k = 0;
  }
  return out;
};

const xorDecrypt = (tab, key) => {
  let res = "";
  let k = 0;
  for (let i = 0; i < tab.length; i++) {
    res += String.fromCharCode(tab[i] - key.charCodeAt(k));
    k++; if (k == key.length) k = 0;
  }
  return res;
};

const download = (data, name) => {
  let blob = new Blob([data], {type:"text/plain"});
  let a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = name;
  a.click();
};

document.getElementById("form").addEventListener("submit", e => {
  e.preventDefault();

  let mode = document.getElementById("mode").value;
  let file = document.getElementById("file").files[0];
  let key  = document.getElementById("key").value;

  if (!file || !key) return alert("File & key wajib!");

  read.readAsText(file);
  read.onload = () => {
    let txt = read.result;

    if (mode === "encrypt") {
      let enc = xorEncrypt(txt, key);
      let lua = "local data={" + enc.join(",") + "} local k=[[" + key + "]] local o='' local i=0 for _,v in pairs(data) do i=i+1 o=o..string.char(v-string.byte(k,i)) if i==#k then i=0 end end load(o)()";
      download(lua, "Encrypted_" + file.name);
    }

    if (mode === "decrypt") {
      try {
        let nums = txt.match(/\{([0-9,]+)\}/)[1].split(",").map(Number);
        let dec = xorDecrypt(nums, key);
        download(dec, "Decrypted_" + file.name);
      } catch {
        alert("Decrypt gagal / key salah");
      }
    }
  };
});
</script>
</body>
</html>
