<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Lua Deobfuscator FIXED</title>
<style>
body{
  background:#1e1e1e;
  color:#0f0;
  font-family:monospace;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh
}
.box{
  width:650px;
  padding:20px;
  background:#111;
  border:1px solid #333
}
input,button,textarea{
  width:100%;
  margin-top:10px;
  padding:10px;
  background:#000;
  color:#0f0;
  border:1px solid #555
}
button{
  background:#ff8f10;
  color:#000;
  font-weight:bold;
  cursor:pointer
}
textarea{height:260px}
</style>
</head>
<body>

<div class="box">
<h2>Lua Deobfuscator (FIX)</h2>

<input type="file" id="file">
<input type="text" id="key" value="monetloader">
<button onclick="run()">DEOBFUSCATE</button>

<textarea id="out" placeholder="Lua result..."></textarea>
</div>

<script>
function run(){
  const file = document.getElementById("file").files[0];
  const key  = document.getElementById("key").value;
  if(!file || !key) return alert("File & key required");

  const r = new FileReader();
  r.readAsText(file);

  r.onload = ()=>{
    const text = r.result;

    // ðŸ”¥ ambil SEMUA array angka
    const arrays = text.match(/\{[\d,\s]{50,}\}/g);
    if(!arrays) return alert("No encrypted array found");

    // ðŸ”¥ pilih array PALING PANJANG
    let payload = arrays.reduce((a,b)=>a.length>b.length?a:b);

    const nums = payload
      .replace(/[{}]/g,"")
      .split(",")
      .map(n=>parseInt(n.trim()));

    let out = "";
    let k = 0;

    for(let i=0;i<nums.length;i++){
      out += String.fromCharCode(
        nums[i] - key.charCodeAt(k)
      );
      k++;
      if(k >= key.length) k = 0;
    }

    document.getElementById("out").value = out;

    // auto download
    const blob = new Blob([out],{type:"text/plain"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "deobfuscated.lua";
    a.click();
  }
}
</script>
</body>
</html>
